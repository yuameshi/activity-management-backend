<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Hello World!</title>
		<link rel="stylesheet" href="style.css" />
	</head>
	<body>
		<h1>Hello World!</h1>
		<div id="error" class="error" style="display: none"></div>

		<p class="muted">Data source：<code>/api/hello</code></p>
		<p class="muted">SQL：<code>SELECT id, content FROM hello ORDER BY id</code></p>
		<details>
			<summary>SQL Query</summary>
			<table aria-label="hello table">
				<thead>
					<tr>
						<th>id</th>
						<th>content</th>
					</tr>
				</thead>
				<tbody id="rows"></tbody>
			</table>
		</details>

		<p class="muted">Data source：<code>/api/hello-desc</code></p>
		<p class="muted">SQL：<code>SELECT id, content FROM hello ORDER BY id DESC</code></p>
		<details>
			<summary>SQL Query (DESC)</summary>
			<table aria-label="hello table desc">
				<thead>
					<tr>
						<th>id</th>
						<th>content</th>
					</tr>
				</thead>
				<tbody id="rows-desc"></tbody>
			</table>
		</details>
		<script>
			const errorEl = document.getElementById('error');
			const rowsEl = document.getElementById('rows');

			function showError(message) {
				errorEl.style.display = 'block';
				errorEl.textContent = message;
			}

			function td(text) {
				const cell = document.createElement('td');
				cell.textContent = text == null ? '' : String(text);
				return cell;
			}

			async function loadData(api, tableId) {
				const resp = await fetch(api, {
					headers: { Accept: 'application/json' },
				});

				if (!resp.ok) {
					const text = await resp.text();
					throw new Error('请求 ' + api + ' 失败，HTTP ' + resp.status + '\n' + text);
				}

				const data = await resp.json();
				if (!Array.isArray(data)) {
					throw new Error('响应不是数组：' + JSON.stringify(data));
				}

				const rows = document.getElementById(tableId);
				rows.innerHTML = '';
				for (const row of data) {
					const tr = document.createElement('tr');
					tr.appendChild(td(row.id));
					tr.appendChild(td(row.content));
					rows.appendChild(tr);
				}
			}

			loadData('/api/hello', 'rows').catch(err => showError(err && err.message ? err.message : String(err)));
			loadData('/api/hello-desc', 'rows-desc').catch(err => showError(err && err.message ? err.message : String(err)));
		</script>
	</body>
</html>
